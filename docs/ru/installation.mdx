---
weight: 50
sourceSHA: b388e5e92403a68a079d96eeb05bddb84953fe0a3ad8ece3f5ce057c9b752903
---

# Установка

В этой статье будет представлено, как установить компоненты, необходимые для учета и выставления счетов.

## Предварительные соображения по установке

- Компоненты **Сервер управления затратами** и **Агент управления затратами** работают совместно, чтобы обеспечить общую функциональность учета и выставления счетов платформы. Компонент серверной части поддерживает возможности хранения данных, связанные с учетом и выставлением счетов, в то время как компонент клиентской части обрабатывает собираемость данных и выставление счетов.

- Компонент **Сервер управления затратами** полагается на ClickHouse в качестве решения для хранения данных. Вы можете либо установить хранилище журналов ACP с плагином ClickHouse, предоставленным платформой, либо установить ClickHouse самостоятельно для интеграции.

- Компонент **Агент управления затратами** требует, чтобы соответствующий кластер имел установленный компонент мониторинга **ACP Monitor с Prometheus**. Пожалуйста, убедитесь, что этот компонент успешно установлен заранее.

## Установка плагина сервера управления затратами

### Предварительные требования

Компонент **Сервер управления затратами** полагается на ClickHouse в качестве решения для хранения данных. Вы можете либо установить хранилище журналов ACP с плагином ClickHouse, предоставленным платформой, либо установить ClickHouse самостоятельно для интеграции.

### Шаги

1. Войдите в кластер, где установлено хранилище журналов ACP с плагином ClickHouse, и получите информацию о интеграции ClickHouse:

```bash
# Получить адрес подключения ClickHouse
kubectl get feature log-center -o jsonpath='{.spec.accessInfo.clickhouse.address}'

# Получить имя пользователя и пароль ClickHouse:
kubectl get secret -n cpaas-system clickhouse-basic-auth -o jsonpath={.data.username}\|base64 -d
kubectl get secret -n cpaas-system clickhouse-basic-auth -o jsonpath={.data.password}\|base64 -d
```

2. В левой навигационной панели нажмите **Магазин приложений** > **Управление плагинами**.

3. Выберите кластер `global`.

4. Найдите плагин сервера управления затратами и нажмите кнопку Установить в правой панели действий.

5. Ознакомьтесь с описанием ниже для настройки соответствующих параметров.

   | Параметр                   | Описание                                                                                                                                                           |
   | --------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
   | **Адрес ClickHouse**       | Настройте адрес подключения ClickHouse                                                                                                                           |
   | **Имя кластера ClickHouse** | Имя кластера для ClickHouse; по умолчанию для ClickHouse, созданного на платформе, используется `replicated.`                                                  |
   | **Имя секрета ClickHouse** | Настройте секрет для имени пользователя и пароля ClickHouse                                                                                                       |
   | **Цена за единицу CPU**    | Установите цену за единицу учета CPU; платформа будет выставлять счета на основе фактического использования (ядро-часа), что является максимальным значением между Запросом и Использованием в течение одного часа.   |
   | **Цена за единицу памяти**  | Установите цену за единицу учета памяти; платформа будет выставлять счета на основе фактического использования (ядро-часа), что является максимальным значением между Запросом и Использованием в течение одного часа. |
   | **Цена за единицу хранения** | Установите цену за единицу учета хранилища; платформа будет выставлять счета на основе объема запроса (GiB-часа), что соответствует размеру запрашиваемого пространства хранилища PV.                         |
   | **Валюта**                 | Выберите валюту для отображения расходов.                                                                                                                         |

6. Нажмите **Установить**.

## Установка плагина агента управления затратами

### Предварительные требования

- Компонент **Агент управления затратами** требует, чтобы соответствующий кластер имел установленный компонент мониторинга **ACP Monitor с Prometheus**. Пожалуйста, убедитесь, что этот компонент успешно установлен заранее.

### Шаги

1. В левой навигационной панели нажмите **Магазин приложений** > **Управление плагинами**.

2. Выберите кластер, где необходимо установить этот плагин.

3. Найдите плагин агента управления затратами и нажмите кнопку Установить в правой панели действий.
