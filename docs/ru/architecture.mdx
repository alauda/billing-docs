---
weight: 15
sourceSHA: ed47a906dbca6cd25c32fcd32fac672f7105e61d967632d47f59e0aeea153a48
---

# Архитектура

![](../zh/assets/billing_flow.png)

Платформа обеспечивает общие возможности учета и выставления счетов благодаря сотрудничеству компонентов **Сервер управления затратами ACP** и **Агент управления затратами ACP**:

- **Сервер управления затратами ACP**: Вам необходимо установить этот плагин в кластер `global`, чтобы использовать функции учета и выставления счетов платформы.

  - Взаимодействует с Clickhouse, отвечает за получение данных, сообщаемых клиентами, и их хранение в базе данных Clickhouse без ограничения по времени хранения данных.

  - Предоставляет API для запроса данных об учете и выставлении счетов.

  - Предлагает возможность изменять цены за единицу и настройки валютных единиц.

  - **Примечание**: Валютная единица, установленная платформой, в настоящее время влияет только на отображение и не поддерживает конвертацию валют между различными единицами.

- **Агент управления затратами ACP**: Вам необходимо установить этот плагин в кластер, в котором планируется учет и выставление счетов, чтобы платформа могла учитывать и выставлять счета за ресурсы в кластере.

  - Взаимодействует с Prometheus, предоставляя экспортёр для хранения данных о метриках учета и выставления счетов в Prometheus.

  - Подключается к **Серверу управления затратами ACP**, агрегирует и вычисляет данные об учете и выставлении счетов для всех ресурсов в кластере на следующий день в 12:30 AM каждый день и передает их на сервер. Если отчет не удается отправить, он попытается повторно отправить его каждые два часа до успешной отправки.
