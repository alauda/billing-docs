---
weight: 50
---

# 安装 

本文将向您介绍如何安装计量计费所依赖的组件

## 安装前须知

* **Cost Management Server** 和  **Cost Management Agent** 配合完成平台整体的计量计费功能提供，服务端组件承载了计量计费的相关数据存储能力，客户端组件承载了计量计费的相关计量采集、计费能力。
  
* **Cost Management Server** 组件依赖使用 ClickHouse 作为数据存储，您可以安装平台提供的 ACP Log Storage with Clickhouse 插件，也可以自行安装 Clickhouse 以对接使用。
  
* **Cost Management Agent** 组件依赖对应集群已安装 **ACP Monitor with Prometheus** 监控组件，请提前确保该组件已安装成功。

## 安装 Cost Management Server 插件

### 前提条件

**Cost Management Serve** 组件依赖使用 ClickHouse 作为数据存储，您可以安装平台提供的 ACP Log Storage with Clickhouse 插件，也可以自行安装 Clickhouse 以对接使用。

### 操作步骤

1. 登录安装了 ACP Log Storage with Clickhouse 插件的集群，获取 Clickhouse 对接信息：

```bash
# 获取 Clickhouse 对接地址
kubectl get feature log-center -o jsonpath='{.spec.accessInfo.clickhouse.address}'

# 获取 Clickhouse 用户名密码：
kubectl get secret -n cpaas-system clickhouse-basic-auth -o jsonpath={.data.username}\|base64 -d
kubectl get secret -n cpaas-system clickhouse-basic-auth -o jsonpath={.data.password}\|base64 -d
```

2. 在左侧导航栏中，单击 **应用商店** > **插件管理**。

2. 选择 global 集群

3. 找到 Cost Management Server 插件，单击右侧操作栏中的安装按钮。

4. 参考以下说明，配置相关参数。

    | 参数 | 说明 |
    | ---- | ---- |
    | **Clickhouse 地址** | 配置 Clickhouse 的对接地址|
    | **Clickhouse 集群名称**| Clickhouse 的集群名称，平台自建的 Clickhouse 默认填 replicated。|
    | **Clickhouse Secret名称**| 配置 Clickhouse 对接用户名密码的 Secret|
    | **CPU 单价**| 设置 CPU 计费单价，平台会按有效使用量（core-hours）进行计量计费，有效使用量即一小时内 Request 和 Usage 的较大值。|
    | **内存单价**| 设置内存计费单价，平台会按有效使用量（core-hours）进行计量计费，有效使用量即一小时内 Request 和 Usage 的较大值。|
    | **存储单价**| 设置存储计费单价，平台会按请求量（GiB-hours）进行计量计费，请求量即 PV 请求的存储空间大小。|
    | **货币单位**| 选择展示费用时使用的货币单位。|

5. 单击 **安装**。


## 安装 Cost Management Agent 插件


### 前提条件

* **Cost Management Agent** 组件依赖对应集群已安装 **ACP Monitor with Prometheus** 监控组件，请提前确保该组件已安装成功。

### 操作步骤

2. 在左侧导航栏中，单击 **应用商店** > **插件管理**。

2. 选择 需要安装本插件的集群

3. 找到 Cost Management Agent 插件，单击右侧操作栏中的安装按钮。
